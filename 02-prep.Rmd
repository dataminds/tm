# 준비

## 컴퓨터 / 인터넷 


## R / R Studio

 - R https://cloud.r-project.org/
 - R Studio Desktop Free https://rstudio.com/products/rstudio/download/#download
 
## 패키지(Package)

패키지는 R함수, 데이터, 완성된 코드를 정리해 종합한 꾸러미다.  라이브러리(library)라고도 한다. 패키지를 R환경에 올리는 함수가 `library()`인 이유다. `require()`도 패키지를 R환경에 올리는 함수이나 `library()`와는 달리, `TRUE`와 `FALSE`값을 산출한다. 

`패키지::함수`와 같은 방식을 이용해도 패키지의 함수를 이용할 수 있다.
```
예: 
pcych::headTail(df)
```

`sessionInfo()`함수를 이용해 R환경에 올려진 패키지와 버전을 확인할 수 있다.
```
sessionInfo( )
```

패키지 버전만 확인하고 싶은 `packageVersion("패키지명")`을 이용한다.

R Studio에서 버전을 확인하는 방법은 다음과 같다. 
```
Tools -> Check for Package Updates ...
```


### tidyverse
정돈된 세계를 구성해 R을 한층 뛰어난 프로그래밍 언어로 만들어준 패키지다. 

`tidyverse`는 정돈된 세상(tidy + universe)이란 의미의 종합패키지다. '정돈된 세계(tidyverse)'안에서는 코딩작업을 직관적이고도 일관성있게 할 수 있다. 해들리 위컴(Hadley Wicham)이 제시한 '정돈된 데이터 원리(tidy data principle)'에 따라 구성한 세계관이다.  `tidyverse`패키지를 설치하면 `ggplot2`, `dplyr`, `tidytext`, `lubridate` 등 다수의 유용한 패키지가 함께 설치된다.

 - Hadley Wicham http://hadley.nz/
 - Tidyverse Overview https://tidyverse.tidyverse.org


먼저 `install.packages()`함수를 이용해 `tidyverse` 패키지를 설치하고, `library()`함수를 이용해 현재의 R환경에 올려 패키지를 사용할 수 있도록 하자. 

```{r eval=FALSE}
install.packages('tidyverse')
```

```{r}
library(tidyverse)
```

설치하면 `-- Attaching packages --`라는 메시지가 뜨며 아래 8종의 패키지 목록이 보인다. 이 8종의 패키지는 `library(tidyverse)`를 통해 `tidyverse`패키지를 현재의 R환경에 올리면 함께 R환경에 올라가는 부착된 패키지다. 즉, 아래 8개 패키지를 `library()`로 개별적으로 올리지 않아도 R환경에서 사용할 수있다. 

 - `ggplot2` 시각화 도구모음. 그래픽의 문법에 기초 
 - `dplyr` 데이터 조작. 일종의 공구상자 
 - `tidyr` 데이터 정돈. 데이터를 정돈하는 함수 제공 
 - `readr` 데이터 이입. 행과 열이 있는 데이터(예: csv, tsv, fwf) 이입(import)
 
 - `purr` 함수형프로그래밍(functional programming) 도구모음
 - `tibble` 데이터프레임의 현대적 양식
 - `sringr`문자형 데이터(string) 작업 도구 모음
 - `forcats` 데이터유형(type)이 요인(factor)일때 발생하는 문제해결 도구모음. 

아래의 패키지는 `tidyverse`와 함께 설치되지만 `library(패키지명)`로 따로 R환경에 올려야 사용할 수 있는 패키지다. 

 - `hms` housr와 time 데이터 처리 도구 모음
 - `lubridate` date와 times 데이터 처리 도구 모음
 
 - `httr` 웹 API 
 - `rvest` 웹 스크레핑 
 - `readxl` xls ghrdms xlsx 파일 이입
 - `haven` SPSS, SAS, STATA 파일 이입
 - `jasonlite` JSON 
 - `xml2` XML
 
 - `modelr` 파이프라인안에서 모델링 
 - `broom` 모델을 tidydata로 


## 오류(error)
Warning(경고)메시지는 참고만 하고 무시해도 되지만, 오류(error)메시지는 거의 대부분 해결해야 다음 단계로 넘어갈 수 있다. 

** 오류가 발생하면 당황하지 말고, 오류메시지를 잘 읽어보자.** 

### 패키지 설치시 겪을 수 있는 오류 

패키지설치할 때 아래와 같은 오류가 발생하는 경우가 있다. 

> library('tidyverse')
Error: package or namespace load failed for ‘tidyverse’ in loadNamespace(i, c(lib.loc, .libPaths()), versionCheck = vI[[i]]):
namespace ‘scales’ 0.4.0 is already loaded, but >= 0.4.1 is required

`tidyverse`패키지와 함께 설치되는 패키지가 의존하는 `scale`패키지가 컴퓨터에서 업데이트돼 있지 않아 오류가 발생했다는 의미다. 

해당 패키지(이 경우 `scale`)를 새로 설치하거나 업데이트한다. 

새로 설치할 때는 `dependencies=TRUE`를 명령어에 추가해 모든 의존 패키지도 설치하도록 하자. 
```
install.packages("패키지명", dependencies=TRUE)
```

패키지 업데이트를 해보는 방법도 있다. 
```
update.packages("패키지명")
```

만일 새로 설치해도 해결이 안되면, 패키지를 R콘솔에서 설치해본다. 이때 R을 관리자권한으로 실행하자. 


그래도 안되면, 패키지가 설치돼 있는 하드디스크폴더에서 해당 패키지 폴더를 삭제하고 다시 설치한다.  

패키지가 설치된 위치는 다음과 같다. 

```
내 PC > 문서 > R > win-library
또는
C:\Users\[윈도사용자]\Documents\R\win-library
예를 들어:
C:\Users\myPC\Documents\R\win-library
```

### 실행할 때 겪을 수 있는 오류

다음과 같은 에러메시지가 뜨는 경우가 있다. 메시지의 내용을 잘 읽어보자. 

```
Error in tibble(text = text_vword) %>% unnest_tokens(output = word, input = text) : 
  함수 "%>%"를 찾을 수 없습니다
```

실행하는데 필요한 함수 `%>%`를 찾을 수 없다는 의미다. `%>%`는 파이핑에 필요한 함수로서 `dplyr`에서 `magrittr`패키지를 통해 제공한다. `dplyr`는 `tidyverse`를 올리면 함께 부착된다. 

따라서 아래 3가지 중 하나만 하면 해결할 수 있다. 
```
library(tidyverse)
또는
library(dplyr)
또는
library(magrittr)

```

마찬가지로 아래와 같은 에러메시지가 뜨면 어떻게 해야할까? 
```  
Error in unnest_tokens(., output = word, input = text) : 
  함수 "unnest_tokens"를 찾을 수 없습니다  
```  

`unnest_tokens`함수를 제공하는 패키지 `tidytext`를 실행한다. 설치가 안돼 있으면 설치부터 한다. 

```{r eval = FALSE}
install.packages('tidytext')
library(tidytext)
```






## 여러 패키지 한번에 설치
(이 부분은 건너 뛰어도 된다.)

텍스트마이닝에는 여러 종류의 패키지가 필요하다. 이 모든 것을 매번 설치하고 번번히 실행하는 것이 번거롭다. 게다가 이미 설치된 패키지가 무엇이 있는지 기억하기 어렵기 때문에, 패키지를 반복해서 설치하는 경우가 있다. 설치돼 있는 패키지는 설치를 피하고, 새로운 패키지만 골라서 동시에 설치하는 방법을 알아보자. 

명령어 앞뒤로 괄호`( )`를 치면 할당한 객체의 내용을 콘솔에서 보여준다. 

```{r eval=FALSE}
names( installed.packages()[,"Package"] )
package_list <- c( "tidyverse", "epubr", "showtext",
                  "tidytext", "tidymodels", "tidygraph", "textclean" )
( package_list_installed <- package_list %in% installed.packages()[,"Package"] )

( new_pkg <- package_list[!package_list_installed] )
if(length(new_pkg)) install.packages(new_pkg)
```


설치한 여러 패키지를 동시에 R환경에 올리는 방법은 다음과 같다. 

```
lapply(package_list, require, character.only = T)
( .packages() )
```

위 코드를 별도의 R파일로 만들어 패키지를 새로 설치할때 실행하면 편리하다.  
설치할 패키지 목록은 작업하는 과정에서 






## 코딩 스타일

일관성 있는 코드작성은 해들리 위컴의 R스타일 가이드를 참조하자.

- [the tidyverse style guide](https://style.tidyverse.org/)

- [일관성 있는 R 코드 작성하기: 해들리 위컴의 R 코딩 스타일 가이드](https://3months.tistory.com/386)

데이터를 할당한 객체이름을 정할 때 데이터구조를 명기하는 습관을 들이는 것이 좋다. 

```
예: 
벡터: name_v
데이터프레임: name_df
매트릭스: name_m
리스트: name_ls
사용자 함수: name_f
토큰: name_tk
```


## 파일경로(path) 표시

### 슬래시 /

윈도에서는 경로 표시 역슬래시`\`를 사용하지만,  R환경에서는 슬래시`/`를 이용해 경로를 표시한다. `\\`처럼 역슬래시를 두번 쓰기도 한다.



`/`만 쓰거나 첫번째로 적는 `/`는 루트디렉토리를 의미한다. 

```
list.files("/") #루트디렉토리에 있는 모든 파일과 폴더 표시
list.files("/data") #루트디렉토리 아래의 data폴더에 있는 모든 파일과 폴더 표시
list.files("data") # 현재 작업디렉토리에 있는 모든 파일과 폴더 표시
```

#### 퀴즈 

`list.files("data\images")`를 실행하면 아래와 같은 오류가 발생한다. 이유는?
```
> list.files("data\images")
에러: ""C:\U"로 시작하는 문자열들 가운데 16진수가 아닌 '\U'가 사용되었습니다
```

윈도에서 사용하는 경로표시 `\`를 R환경에서 사용했기 때문이다. `\`를 `/`로 수정한다. 


### 마침표 . .. 

- 마침표 하나`.` 현재 작업디렉토리
- 마침표 둘`..` 현재 작업디렉토리 바로 한단계 위에 있는 폴더 


```
list.files(".") #작업디렉토리에 있는 모든 파일과 폴더 표시
list.files("./images") #작업디렉토리아래에 있는 images폴더에 있는 모든 파일과 폴더 표시. 
```
`list.files("./images")`의 산출결과는 `list.files("images")`와 같다. `./images`와 `images`는 둘다 현재 작업디렉토리 의미.

```
list.files("..") # 작업디렉토리 위 폴더에 있는 모든 파일과 폴더 표시
list.files("../dir") #작업디렉토의 위 폴더 아래(즉, 현 작업디렉토리와 같은 단계의 위치에 있는 폴더) 아래에 있는 images폴더에 있는 모든 파일과 폴더 표시

```

### 물결 ~

물결표시`~`는 홈디렉토리를 의미한다. 로그인 사용자가 사용할 수 있는 최상위 디렉토리.

윈도의 경우에서 만일 사용자 ID를 user1이라고 한 경우 `C:/Users/user1/Documents`폴더가 홈디렉토리가 된다.
(윈도환경에서는 경로를 역슬래시를 사용하므로 `C:\Users\user1\Documents`로 표시된다.)

따라서 `list.files("~")`과 `list.files("C:/Users/user1/Documents")`는 같은 결과 산출. 

```
list.files("~") #홈디렉토리에 있는 모든 파일 표시
list.files("~/R/win-library") #홈디렉토리 아래단계에 있는 R/win-library폴더의 모든 파일과 폴더 표시 

```



## 파일과 객체

### 하드디스크에 있는 파일을 다루는 함수

```
dir.create("C:/newdir") 디렉토리(폴더) 생성
list.files() 현재 작업디렉토리 파일과 폴더 목록
```


### R환경에 올려진 객체를 다루는 함수

```
ls() 현재 작업공간에 있는 객체 목록
rm(객체명) 작업공간의 객체 제거. 필요없는 객체 제거에 사용. 
```

```
getwd() 작업디렉토리(working directory) 표시
setwd("C:/newdir") "C:/newdir"을 작업디록토리 설정
```

단일 R객체를 파일로 저장하는 방법

```
saveRDS(name_df, file = "name_df.rds")
name_df <-readRDS("name_df.rds")

```

복수의 R객체를 파일로 저장
```
save(n1_df, n2_df, file = "name.RData") n1_df과 n2_df객체를 작업디렉토리에 name.RData란 이름의 파일로 저장
load("name.RData") name.RData를 작업공간에 탑재
```

R환경의 모든 객체를 이미지로 저장. 
```
save.images("myData.RData") 작업공간을 이미지파일로 저장. 파일명 지정하지 않으면 .RData로 저장. 
load("myData.RData") 작업디렉토리 파일을 현 작업공간에 객체로 탑재
```


## 따옴표와 백틱

### 겹따옴표 홑따옴표
겹따옴표와 홑따옴표는 문자형요소를 지칭하는데, 함께 사용해야 할때가 있다. 

인용문안에서 인용해야 할때는 겹따옴표와 홑따옴표를 함께 사용한다. 

```
"이렇게 인용문 안에 '다시 인용할때' 겹따옴표와 홑따옴표를 함께 사용"
```

### 백틱(backquote/backtick) `

변수 혹은 객체명이 한글 특수기호 혹은 띄어쓰기가 있는 경우, 키보드 가장 왼쪽 위에 있는 부호 백틱 한쌍을 이용한다. 

```
`한글변수(명)`

```


## 주의(중요)

R작업에 관련된 폴더이름은 모두 영문으로 지정한다. 한글명 폴더를 이용할 경우 오류발생하는 경우가 드물지 않다. 


폴더명을 지정할 때 띄어쓰기를 하지않는다. 오류의 원인이다. 데이터분석 작업을 하는 폴더의 이름은 모두 영문으로 붙여쓴다. 


R스튜디오는 작업디렉토리 기본설정을 홈디렉토리(~)로 해 놓았다. 만일 윈도나 맥 등 운영체제에서 한글을 사용자명으로 지정했을 꼉우, 경로에 한글폴더가 포함된다. 대부분 문제없지만, 간혹 오류 발생의 원인이 된다. 


작업디렉토리 기본값을 루트디렉토리 아래 영문폴더(예: `C:/data`)를 만들어 설정하자. 








